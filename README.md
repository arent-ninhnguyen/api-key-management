# API Key Management Dashboard

A dashboard for managing API keys with Supabase integration.

## Features

- Create, read, update, and delete API keys
- Set usage limits for individual keys
- Track API key usage
- Secure key storage with Supabase

## Project Specification

### Overview
This application provides a comprehensive solution for managing API keys with advanced features for tracking usage, setting limits, and secure validation. It's built with a modern frontend architecture using Next.js and integrates with Supabase for backend functionality.
This project uses Cypress for end-to-end testing. The tests verify the functionality of the API key management features, dashboard, and playground. See the [E2E Testing with Cypress](#e2e-testing-with-cypress) section below for details on running tests.

### Core Components

#### 1. Dashboard
- **API Key Statistics**: Displays total keys, active keys, and API usage metrics
- **API Key Table**: Lists all keys with details including name, status, usage, and creation date
- **Usage Visualization**: Shows current usage compared to limits with appropriate warning indicators
- **Responsive Design**: Adapts to desktop, tablet, and mobile viewports

#### 2. API Key Management
- **Create Modal**: Form to create new API keys with name and optional usage limits
- **Edit Modal**: Update existing keys, modify names and usage limits
- **Delete Confirmation**: Safe deletion with confirmation dialog
- **Copy Functionality**: One-click copy to clipboard with feedback

#### 3. API Key Validation
- **Playground Interface**: Test environment for validating API keys
- **Real-time Validation**: Immediate feedback on key validity
- **Error Handling**: Clear error messages for invalid keys
- **Usage Tracking**: Increments usage count when keys are validated

#### 4. Security Features
- **Secure Storage**: Keys stored securely in Supabase with encryption
- **Usage Limits**: Prevent abuse by setting and enforcing usage caps
- **User-specific Keys**: Each user can only access their own API keys
- **Validation Safeguards**: Rate limiting and protection against brute-force attempts

### Technical Implementation

#### Frontend
- **React Components**: Modular design with reusable components
- **State Management**: Context API for application state
- **Styling**: Tailwind CSS for responsive, utility-first styling
- **Forms**: Validation with client-side error handling
- **Animations**: Smooth transitions and loading states
- **Edge Cases**: Testing for limit conditions, errors, and validation scenarios

#### Backend Integration
- **Supabase API**: REST endpoints for CRUD operations
- **Authentication**: User-specific data access with row-level security
- **Data Structure**: Optimized schema for API key management
- **Error Handling**: Comprehensive error states with user-friendly messages

#### Testing
- **Cypress Tests**: End-to-end testing for all key functionality
- **Test Coverage**: Dashboard views, API key operations, and playground validation
- **Mock Data**: Simulated API responses for consistent testing
- **Edge Cases**: Testing for limit conditions, errors, and validation scenarios

### Setup Instructions

### 1. Supabase Setup

1. Create a new project on [Supabase](https://supabase.com)
2. Create a new table called `api_keys` with the following schema:

```sql
create table api_keys (
  id bigint generated by default as identity primary key,
  name text not null,
  key text not null unique,
  usage integer default 0,
  status text default 'Active',
  usage_limit boolean default false,
  limit_value integer,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  user_id uuid references auth.users(id)
);

-- Create policies for RLS (Row Level Security)
alter table api_keys enable row level security;

-- Policy to only allow users to see their own API keys
create policy "Users can view their own API keys" 
  on api_keys for select 
  using (auth.uid() = user_id);

-- Policy to only allow users to insert their own API keys
create policy "Users can insert their own API keys" 
  on api_keys for insert 
  with check (auth.uid() = user_id);

-- Policy to only allow users to update their own API keys
create policy "Users can update their own API keys" 
  on api_keys for update 
  using (auth.uid() = user_id);

-- Policy to only allow users to delete their own API keys
create policy "Users can delete their own API keys" 
  on api_keys for delete 
  using (auth.uid() = user_id);
```

3. Get your Supabase URL and anon key from the project settings

### 2. Environment Variables

1. Copy the `.env.local` file and update with your Supabase credentials:

```
NEXT_PUBLIC_SUPABASE_URL=https://YOUR_SUPABASE_URL.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=YOUR_SUPABASE_ANON_KEY
```

### 3. Install Dependencies and Run

```bash
npm install
npm run dev
```

## Technology Stack

- Next.js
- Tailwind CSS
- Supabase (PostgreSQL + Auth)

This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.js`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.

## E2E Testing with Cypress

This project uses Cypress for end-to-end testing. The tests verify the functionality of the API key management features, dashboard, and playground.

### Prerequisites

- Node.js 14+ installed
- Project dependencies installed (`npm install`)

### Folder Structure

The Cypress tests follow the standard Cypress directory structure:

```
/cypress
  /e2e              - Test files organized by feature
    - api-keys.cy.js    - Tests for API key management
    - dashboard.cy.js   - Tests for dashboard functionality
    - overview.cy.js    - Tests for overview page statistics and navigation
    - playground.cy.js  - Tests for API key validation
  /fixtures         - Mock data used in tests
  /support          - Test helpers and custom commands
  /screenshots      - Saved automatically when tests fail
  /videos           - Recordings of test runs
```

### Running the Tests

1. **Start the development server in one terminal:**

```bash
npm run dev
```

2. **Run Cypress tests in another terminal:**

To open Cypress interactive test runner:
```bash
npm run cypress
```

To run tests in headless mode:
```bash
npm run test
```

To run a specific test file:
```bash
npx cypress run --spec "cypress/e2e/overview.cy.js"
```

### Test Scenarios

#### Overview Page Tests (overview.cy.js)

1. **Page Structure Verification**:
   - Verifies the page title and main components are displayed
   - Confirms the grid layout exists

2. **Statistics Display**:
   - Tests that statistics are displayed correctly based on API data
   - Verifies "Total API Keys", "Active Keys", and "Total Requests" counters
   - Validates numeric data is displayed correctly

3. **Navigation Testing**:
   - Checks that quick action links exist
   - Verifies clicking links navigates to the correct pages

4. **Responsive Design**:
   - Tests display on desktop viewport (1280x800)
   - Tests display on tablet viewport (768x1024)
   - Tests display on mobile viewport (375x667)
   - Ensures content remains accessible across all device sizes

#### API Key Management Tests (api-keys.cy.js)

1. **Key Creation**:
   - Tests opening the create modal
   - Verifies form input and submission
   - Validates error handling for invalid inputs
   - Confirms newly created key appears in the table

2. **Key Editing**:
   - Tests opening the edit modal with correct initial values
   - Verifies updating key name and usage limits
   - Confirms changes are reflected in the UI after editing

3. **Key Deletion**:
   - Tests opening the delete confirmation modal
   - Verifies cancellation works properly
   - Tests successful deletion and UI updates
   - Validates error handling during deletion

4. **Copy Functionality**:
   - Tests copying API keys to clipboard
   - Validates feedback is provided after copying

#### Dashboard Tests (dashboard.cy.js)

1. **Dashboard Loading**:
   - Tests page load and component rendering
   - Verifies statistics appear after API data is fetched

2. **Statistics Display**:
   - Tests correct display of total keys, active keys, and usage
   - Verifies research plan and limits are displayed

3. **API Key Table**:
   - Tests table headers are displayed
   - Verifies key data is displayed correctly
   - Tests table interactions

4. **Error States**:
   - Tests appropriate UI is shown when API fails to load
   - Verifies error messages and recovery options

#### Playground Tests (playground.cy.js)

1. **API Key Validation**:
   - Tests successful validation of valid keys
   - Verifies rejection of invalid keys
   - Tests handling of keys exceeding usage limits

2. **Usage Limit Management**:
   - Tests display of usage limit exceeded message
   - Verifies normal operation when under limits

3. **User Interface Feedback**:
   - Tests loading state during validation
   - Verifies temporary error messages
   - Tests form disabling during submission
   - Validates error message styling

4. **Data Management**:
   - Tests API key details storage in localStorage
   - Verifies input clearing after successful validation
   - Tests graceful handling of API errors

5. **Navigation**:
   - Tests redirect to protected page after successful validation
   - Verifies dashboard link navigation
   - Tests URL maintenance on validation failure
   - Validates dashboard link display when API limit exceeded

### Running Tests on Cypress Cloud

This project is configured to run tests on Cypress Cloud, providing test analytics, parallelization, and easy debugging.

#### Setup for Local Development

1. **Get the Cypress Record Key**

   Contact your team administrator to get the Cypress Cloud Record Key.

2. **Run with Recording**

   Use the NPM scripts to run tests with recording:

   ```bash
   # Run all tests and record to Cypress Cloud
   npm run test:cloud
   
   # Run only the overview tests and record
   npm run test:overview:cloud
   ```

   Or run manually with:

   ```bash
   # Record with environment variable
   CYPRESS_RECORD_KEY=your-key-here cypress run --record
   
   # Record with command line flag
   cypress run --record --key your-key-here
   ```

#### CI/CD Integration

The GitHub Actions workflow is already configured to record test results to Cypress Cloud. To enable this functionality:

1. Add the `CYPRESS_RECORD_KEY` as a repository secret in GitHub
2. Ensure the workflow file has `record: true` in the Cypress run step
3. Commits to main, master, or develop branches will automatically trigger test runs that record to Cypress Cloud

For more information on Cypress Cloud, visit [https://www.cypress.io/cloud](https://www.cypress.io/cloud).

### GitHub Actions CI Integration

This project includes GitHub Actions workflow for continuous integration:

```yaml
name: Cypress Tests
on:
  push:
    branches: [main, master, develop]
  pull_request:
    branches: [main, master, develop]

jobs:
  cypress-run:
    runs-on: ubuntu-latest
    env:
      NEXT_PUBLIC_SUPABASE_URL: 'https://example-ci-test.supabase.co'
      NEXT_PUBLIC_SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.mock-key-for-ci-testing'
      # Reduce logging output - only show errors and warnings
      CYPRESS_DEBUG: false
      DEBUG: ''
      # Cypress Cloud recording key
      CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build Next.js
        run: npm run build
      
      - name: Cypress run
        uses: cypress-io/github-action@v5
        with:
          start: npm start
          wait-on: 'http://localhost:3000'
          browser: chrome
          record: true
          config: 'viewportWidth=1280,viewportHeight=800,defaultCommandTimeout=10000'
          quiet: true
      
      - name: Upload screenshots
        uses: actions/upload-artifact@v4
        if: failure()
        with:
          name: cypress-screenshots
          path: cypress/screenshots
          if-no-files-found: ignore
      
      - name: Upload videos
        uses: actions/upload-artifact@v4
        if: failure()
        with:
          name: cypress-videos
          path: cypress/videos
          if-no-files-found: ignore
          
      - name: Upload Cypress logs
        uses: actions/upload-artifact@v4
        if: failure()
        with:
          name: cypress-logs
          path: cypress/logs
          if-no-files-found: ignore
```
